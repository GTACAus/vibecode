<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width,initial-scale=1" />
    <title>IMDbAPI Movie Search</title>
    <style>
        :root{
            --bg:#0f1724; --card:#0b1220; --muted:#94a3b8; --accent:#06b6d4; --glass: rgba(255,255,255,0.03);
            font-family: Inter, ui-sans-serif, system-ui, -apple-system, "Segoe UI", Roboto, "Helvetica Neue", Arial;
            color: #e6eef8;
        }
        html,body{height:100%; margin:0; background:linear-gradient(180deg,#07101a 0%, #081827 100%); }
        .wrap{max-width:900px; margin:32px auto; padding:20px;}
        header{display:flex;align-items:center;gap:14px;margin-bottom:18px}
        h1{font-size:20px;margin:0;color:var(--accent)}
        p.lead{margin:0;color:var(--muted);font-size:13px}
        .search{
            display:flex; gap:8px; margin-top:14px;
        }
        input[type="search"]{
            flex:1; padding:10px 12px; border-radius:8px; border:1px solid rgba(255,255,255,0.04);
            background:var(--glass); color:inherit; outline:none; font-size:14px;
            box-shadow: 0 1px 0 rgba(255,255,255,0.02) inset;
        }
        button{padding:10px 14px; border-radius:8px; border:0; background:var(--accent); color:#042027; font-weight:600; cursor:pointer}
        button:disabled{opacity:.6; cursor:default}
        .results{margin-top:18px; display:grid; grid-template-columns: repeat(auto-fill,minmax(260px,1fr)); gap:14px;}
        .card{background:linear-gradient(180deg, rgba(255,255,255,0.02), rgba(255,255,255,0.01)); border-radius:10px; padding:12px; display:flex; gap:10px; align-items:flex-start; border:1px solid rgba(255,255,255,0.03)}
        .poster{width:86px; height:128px; background:#071922; border-radius:6px; overflow:hidden; flex:0 0 86px; display:flex; align-items:center; justify-content:center}
        .poster img{width:100%;height:100%;object-fit:cover; display:block}
        .meta{flex:1; min-width:0}
        .title{font-weight:700; font-size:15px; margin:0 0 4px 0}
        .sub{color:var(--muted); font-size:13px; margin:0 0 8px 0}
        .genres{font-size:12px;color:var(--muted); margin-bottom:8px}
        .plot{font-size:13px; color:#d7e6f8; opacity:0.9; margin-bottom:8px; max-height:88px; overflow:hidden}
        .meta-row{display:flex; gap:8px; flex-wrap:wrap; align-items:center; font-size:13px}
        .badge{background:rgba(255,255,255,0.03); padding:6px 8px; border-radius:8px; font-weight:600; color:var(--muted); font-size:12px}
        .empty{padding:24px; text-align:center; color:var(--muted); background:var(--card); border-radius:10px}
        .small{font-size:12px;color:var(--muted)}
        footer{margin-top:18px; font-size:12px; color:var(--muted)}
        .spinner{width:18px;height:18px;border:3px solid rgba(255,255,255,0.08); border-top-color:var(--accent); border-radius:50%; animation:spin 1s linear infinite; display:inline-block; vertical-align:middle}
        @keyframes spin{to{transform:rotate(360deg)}}
        a.external{color:var(--accent); text-decoration:none; font-weight:600; font-size:12px}

.back-button {
    position: fixed;
    top: 20px;
    right: 20px;
    background: #0a84ff;
    color: white;
    padding: 10px 16px;
    border-radius: 8px;
    text-decoration: none;
    font-weight: bold;
    z-index: 10000;
    box-shadow: 0 4px 10px rgba(0,0,0,0.2);
}

.back-button:hover {
    background: #0066cc;
}

        
    </style>
</head>
<body>
    <div class="wrap">
        <header>
            <div>
                <h1>IMDbAPI Search</h1>
                <p class="lead">Search movie / title by name using api.imdbapi.dev</p>
            </div>
        </header>
<a href="https://gtacaus.github.io/vibecode/index.html" class="back-button">⟵ Back</a>

        <div>
            <form id="searchForm" class="search" autocomplete="off">
                <input id="query" type="search" placeholder="Enter movie or show name (e.g. Inception)" />
                <button id="searchBtn" type="submit">Search</button>
            </form>
            <div style="margin-top:8px;display:flex;gap:8px;align-items:center">
                <label class="small" style="display:inline-flex;gap:8px;align-items:center">
                    <input id="onlyMovies" type="checkbox" /> Only movies
                </label>
                <div id="status" style="margin-left:auto;color:var(--muted);font-size:13px"></div>
            </div>
        </div>

        <div id="results" class="results" aria-live="polite"></div>

        <footer>
            Powered by <a class="external" href="https://imdbapi.dev" target="_blank" rel="noopener">api.imdbapi.dev</a>
        </footer>
    </div>

    <script>
        // Single-file web app that queries https://api.imdbapi.dev/titles?name=...
        const form = document.getElementById('searchForm');
        const qInput = document.getElementById('query');
        const results = document.getElementById('results');
        const status = document.getElementById('status');
        const searchBtn = document.getElementById('searchBtn');
        const onlyMovies = document.getElementById('onlyMovies');

        function setStatus(text, busy=false){
            status.textContent = text || '';
            searchBtn.disabled = !!busy;
            if (busy) status.innerHTML = '<span class="spinner"></span> Searching…';
        }

        function safeText(s){ return s == null ? '' : String(s); }

        function renderCard(item){
            const imgUrl = item.primaryImage && item.primaryImage.url ? item.primaryImage.url : '';
            const title = safeText(item.primaryTitle || item.originalTitle);
            const year = item.startYear ? ` (${item.startYear})` : '';
            const plot = safeText(item.plot || '');
            const genres = Array.isArray(item.genres) ? item.genres.join(', ') : '';
            const rating = item.rating && item.rating.aggregateRating ? item.rating.aggregateRating : null;
            const votes = item.rating && item.rating.voteCount ? item.rating.voteCount : null;
            const type = item.type || '';
            const id = item.id || '';

            const div = document.createElement('div');
            div.className = 'card';
            div.innerHTML = `
                <div class="poster">
                    ${imgUrl ? `<img loading="lazy" src="${imgUrl}" alt="${escapeHtml(title)} poster">` : `<svg width="86" height="128" viewBox="0 0 86 128" xmlns="http://www.w3.org/2000/svg"><rect width="86" height="128" fill="#071922"/><text x="50%" y="50%" fill="#27414d" font-size="11" text-anchor="middle" dominant-baseline="middle">No Image</text></svg>`}
                </div>
                <div class="meta">
                    <div class="title">${escapeHtml(title)}<span style="color:var(--muted);font-weight:600"> ${escapeHtml(year)}</span></div>
                    <div class="sub">${escapeHtml(item.originalTitle ? item.originalTitle : '')}</div>
                    ${genres ? `<div class="genres">${escapeHtml(genres)}</div>` : ''}
                    ${plot ? `<div class="plot">${escapeHtml(plot)}</div>` : ''}
                    <div class="meta-row">
                        ${rating !== null ? `<div class="badge">⭐ ${escapeHtml(rating.toString())}${votes ? ` • ${escapeHtml(votes.toString())} votes` : ''}</div>` : ''}
                        ${type ? `<div class="badge">${escapeHtml(type)}</div>` : ''}
                        ${id ? `<a class="external" href="https://www.imdb.com/title/${escapeHtml(id)}/" target="_blank" rel="noopener">Open on IMDb</a>` : ''}
                    </div>
                </div>
            `;
            return div;
        }

        // Basic HTML escape to avoid injection from API responses
        function escapeHtml(str){
            return String(str)
                .replace(/&/g, "&amp;")
                .replace(/</g, "&lt;")
                .replace(/>/g, "&gt;")
                .replace(/"/g, "&quot;")
                .replace(/'/g, "&#39;");
        }

        async function search(query, onlyMoviesFlag){
            const q = String(query || '').trim();
            if (!q){
                results.innerHTML = `<div class="empty">Please enter a search term.</div>`;
                setStatus('');
                return;
            }
            setStatus('Searching…', true);
            results.innerHTML = '';
            try {
                // Stronger cache-buster (timestamp + random) to avoid any intermediate caching
                const params = new URLSearchParams();
                params.set('name', q);
                if (onlyMoviesFlag) params.append('types', 'MOVIE');
                params.set('cb', `${Date.now()}-${Math.random().toString(36).slice(2)}`);
                const url = `https://api.imdbapi.dev/titles?${params.toString()}`;

                console.debug('IMDbAPI request URL:', url);
                const resp = await fetch(url, {
                    method: 'GET',
                    mode: 'cors',
                    cache: 'no-store',
                    credentials: 'omit',
                    headers: { 'Accept': 'application/json' }
                });

                // log response status + headers
                console.debug('Response status:', resp.status, resp.statusText);
                for (const [k,v] of resp.headers.entries()){
                    console.debug('resp.header:', k, v);
                }

                // read raw text for debugging (some APIs return identical sample JSON on error)
                const raw = await resp.text();
                console.debug('Raw response text:', raw.slice(0, 500)); // limit log size
                let json;
                try {
                    json = raw ? JSON.parse(raw) : null;
                } catch(parseErr){
                    throw new Error('Failed to parse JSON response: ' + parseErr.message + ' — raw: ' + raw.slice(0,200));
                }

                if (!resp.ok) {
                    // If API returns a JSON error body, include it
                    const errMsg = (json && (json.message || json.error)) ? (json.message || json.error) : `HTTP ${resp.status}`;
                    throw new Error(errMsg);
                }

                console.debug('Parsed JSON:', json);

                if (Array.isArray(json.titles) && json.titles.length){
                    const list = json.titles.slice(0, 12);
                    for (const item of list){
                        results.appendChild(renderCard(item));
                    }
                    setStatus(`${json.totalCount ?? list.length} result(s)`);
                } else {
                    results.innerHTML = `<div class="empty">No results found.</div>`;
                    setStatus('0 results');
                }
            } catch (err){
                console.error(err);
                results.innerHTML = `<div class="empty">Error fetching results: ${escapeHtml(err.message || String(err))}</div>`;
                setStatus('Error');
            } finally {
                searchBtn.disabled = false;
            }
        }

        // quick search on enter or button
        form.addEventListener('submit', e => {
            e.preventDefault();
            search(qInput.value, onlyMovies.checked);
        });
        qInput.addEventListener('keydown', e => {
            if (e.key === 'Enter') {
                e.preventDefault();
                search(qInput.value, onlyMovies.checked);
            }
        });

        // sample popular suggestions on load
        (function init(){
            const popular = ['Inception','The Matrix','The Shawshank Redemption','The Dark Knight'];
            results.innerHTML = popular.map(p => `<div class="card" style="align-items:center"><div style="flex:1;padding:10px">${escapeHtml(p)}</div></div>`).join('');
            setStatus('');
        })();
    </script>
</body>
</html>
